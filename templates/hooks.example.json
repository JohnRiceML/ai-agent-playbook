{
  "_comment": "Copy the hooks you need into your .claude/settings.json file. Mix and match.",

  "hooks": {

    "PreToolUse": [
      {
        "_comment": "--- SECURITY: Block dangerous commands ---",
        "matcher": "Bash",
        "description": "Block rm -rf",
        "command": "jq -r '.tool_input.command // \"\"' | grep -qE 'rm\\s+-rf' && echo 'BLOCKED: Use trash instead of rm -rf' >&2 && exit 2 || exit 0"
      },
      {
        "matcher": "Bash",
        "description": "Block force push to main/master",
        "command": "jq -r '.tool_input.command // \"\"' | grep -qE 'git\\s+push.*--force.*\\b(main|master)\\b' && echo 'BLOCKED: Never force push to main' >&2 && exit 2 || exit 0"
      },
      {
        "matcher": "Bash",
        "description": "Block database migrations without approval",
        "command": "jq -r '.tool_input.command // \"\"' | grep -qE '(prisma\\s+db\\s+push|prisma\\s+migrate\\s+deploy|knex\\s+migrate)' && echo 'BLOCKED: Database migrations require human approval' >&2 && exit 2 || exit 0"
      },
      {
        "_comment": "--- AUDIT: Log every tool call ---",
        "matcher": "*",
        "description": "Log every tool call for audit trail",
        "command": "cat | jq -c '{type: \"tool_start\", tool: .tool_name, timestamp: (now * 1000 | floor), content: (if .tool_name == \"Bash\" then (.tool_input.command // \"\")[0:200] elif .tool_name == \"Read\" or .tool_name == \"Write\" or .tool_name == \"Edit\" then (.tool_input.file_path // \"\") elif .tool_name == \"Glob\" or .tool_name == \"Grep\" then (.tool_input.pattern // \"\") else \"\" end)}' >> ~/.claude/agent-events.jsonl 2>/dev/null || true"
      }
    ],

    "PostToolUse": [
      {
        "_comment": "--- QUALITY: Auto-format after file writes ---",
        "matcher": "Write",
        "description": "Auto-format written files with Prettier",
        "command": "jq -r '.tool_input.file_path // \"\"' | xargs -I{} npx prettier --write {} 2>/dev/null || true"
      },
      {
        "_comment": "--- AUDIT: Detect and log errors ---",
        "matcher": "*",
        "description": "Detect errors in tool responses",
        "command": "cat | jq -c '{type: \"tool_end\", tool: .tool_name, success: (if .tool_response and (.tool_response | type == \"string\") and ((.tool_response | test(\"^[Ee]rror\")) or (.tool_response | contains(\"failed\"))) then false else true end), timestamp: (now * 1000 | floor)}' >> ~/.claude/agent-events.jsonl 2>/dev/null || true"
      },
      {
        "_comment": "--- AUDIT: Log all bash commands separately ---",
        "matcher": "Bash",
        "description": "Full bash audit log",
        "command": "echo \"$(date -u +%Y-%m-%dT%H:%M:%SZ) | $(cat | jq -r '.tool_input.command // \"\"' | head -c 500)\" >> ~/.claude/bash-audit.log 2>/dev/null || true"
      }
    ],

    "SessionStart": [
      {
        "description": "Log session start with context",
        "command": "echo '{\"type\":\"session_start\",\"cwd\":\"'$(pwd)'\",\"timestamp\":'$(date +%s)000'}' >> ~/.claude/agent-events.jsonl"
      }
    ]
  }
}
